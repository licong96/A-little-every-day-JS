!function(i){var t=function(){var t=this;this.popupMask=i('<div id="G-lightbox-mask">'),this.popupWin=i('<div id="G-lightbox-popup">'),this.bodyNode=i(document.body),this.renderDOM(),this.picViewArea=this.popupWin.find("div.lightbox-pic-view"),this.popupPic=this.popupWin.find("img.lightbox-image"),this.picCaptionArea=this.popupWin.find("div.lightbox-pic-caption"),this.nextBtn=this.popupWin.find("span.lightbox-next-btn"),this.prevBtn=this.popupWin.find("span.lightbox-prev-btn"),this.captionText=this.popupWin.find("p.lightbox-pic-desc"),this.currentIndex=this.popupWin.find("span.lightbox-of-index"),this.closeBtn=this.popupWin.find(".lightbox-close-btn"),this.groupName=null,this.groupData=[],this.bodyNode.delegate(".js-lightbox, *[data-role=lightbox]","click",function(s){s.stopPropagation();var a=i(this).attr("data-group");a!==t.groupName&&(t.groupName=a,t.getGroup()),t.initPopup(i(this))}),this.popupMask.click(function(){i(this).fadeOut(),t.popupWin.fadeOut(),t.clear=!1}),this.closeBtn.click(function(){t.popupMask.fadeOut(),t.popupWin.fadeOut(),t.clear=!1}),this.flag=!0,this.nextBtn.hover(function(){!i(this).hasClass("disabled")&&t.groupData.length>1&&i(this).addClass("lightbox-next-btn-show")},function(){!i(this).hasClass("disabled")&&t.groupData.length>1&&i(this).removeClass("lightbox-next-btn-show")}).click(function(s){!i(this).hasClass("disabled")&&t.flag&&(s.stopPropagation(),t.flag=!1,t.goto("next"))}),this.prevBtn.hover(function(){!i(this).hasClass("disabled")&&t.groupData.length>1&&i(this).addClass("lightbox-prev-btn-show")},function(){!i(this).hasClass("disabled")&&t.groupData.length>1&&i(this).removeClass("lightbox-prev-btn-show")}).click(function(s){!i(this).hasClass("disabled")&&t.flag&&(s.stopPropagation(),t.flag=!1,t.goto("prev"))});var s=null;this.clear=!1,i(window).resize(function(){t.clear&&(window.clearTimeout(s),s=window.setTimeout(function(){t.loadPicSize(t.groupData[t.index].src)},500))})};t.prototype={goto:function(i){if("next"===i){this.index++,this.index>=this.groupData.length-1&&this.nextBtn.addClass("disabled").removeClass("lightbox-next-btn-show"),0!=this.index&&this.prevBtn.removeClass("disabled");t=this.groupData[this.index].src;this.loadPicSize(t)}else if("prev"===i){this.index--,this.index<=0&&this.prevBtn.addClass("disabled").removeClass("lightbox-prev-btn-show"),this.index!=this.groupData.length-1&&this.nextBtn.removeClass("disabled");var t=this.groupData[this.index].src;this.loadPicSize(t)}},showMaskAndPopup:function(t,s){var a=this;this.popupPic.hide(),this.picCaptionArea.hide(),this.popupMask.fadeIn();var o=i(window).width(),n=i(window).height();this.picViewArea.css({width:o/2,height:n/2}),this.popupWin.fadeIn();var e=n/2+10;this.popupWin.css({width:o/2+10,height:n/2+10,marginLeft:-(o/2+10)/2,top:-e}).animate({top:(n-e)/2},function(){a.loadPicSize(t)}),this.index=this.getIndexOf(s),this.groupData.length>1&&(0===this.index?(this.prevBtn.addClass("disabled"),this.nextBtn.removeClass("disabled")):this.index===this.groupData.length-1?(this.nextBtn.addClass("disabled"),this.prevBtn.removeClass("disabled")):(this.nextBtn.removeClass("disabled"),this.prevBtn.removeClass("disabled")))},loadPicSize:function(i){var t=this;t.popupPic.css({width:"auto",height:"auto"}).hide(),t.picCaptionArea.hide(),this.preLoadImg(i,function(){console.log("图片加载完成"),t.popupPic.attr("src",i);var s=t.popupPic.width(),a=t.popupPic.height();console.log(s,a),t.changePic(s,a)})},changePic:function(t,s){var a=this,o=i(window).width(),n=i(window).height(),e=Math.min(o/(t+10),n/(s+10),1);t*=e,s*=e,this.picViewArea.animate({width:t-10,height:s-10}),this.popupWin.animate({width:t,height:s,marginLeft:-t/2,top:(n-s)/2},function(){a.popupPic.css({width:t-10,height:s-10}).fadeIn(),a.picCaptionArea.fadeIn(),a.flag=!0,a.clear=!0}),this.captionText.text(this.groupData[this.index].caption),this.currentIndex.text("当前索引："+(this.index+1)+" or "+this.groupData.length)},preLoadImg:function(i,t){var s=new Image;window.ActiveXObject?s.onreadystatechange=function(){"complete"==this.readyState&&t()}:s.onload=function(){t()},s.src=i},getIndexOf:function(t){var s=0;return i(this.groupData).each(function(i){if(s=i,this.id===t)return!1}),s},initPopup:function(i){console.log(i);var t=i.attr("data-source"),s=i.attr("data-id");this.showMaskAndPopup(t,s)},getGroup:function(){var t=this,s=this.bodyNode.find("*[data-group="+this.groupName+"]");t.groupData.length=0,s.each(function(){t.groupData.push({src:i(this).attr("data-source"),id:i(this).attr("data-id"),caption:i(this).attr("data-caption")})}),console.log(t.groupData)},renderDOM:function(){this.popupWin.html(i.trim('<div class="lightbox-pic-view"><span class="lightbox-btn lightbox-prev-btn"></span><img src="images/2-2.jpg" class="lightbox-image"><span class="lightbox-btn lightbox-next-btn"></span></div><div class="lightbox-pic-caption"><div class="lightbox-caption-area"><p class="lightbox-pic-desc"></p><span class="lightbox-of-index">当前索引：0 of 0</span></div><div class="lightbox-close-btn"></div></div>')),this.bodyNode.append(this.popupMask,this.popupWin)}},window.LightBox=t}(jQuery);